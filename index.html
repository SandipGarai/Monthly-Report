<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monthly Report Form</title>

    <!-- CSS -->
    <link rel="stylesheet" href="style.css" />

    <!-- PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- ZIP creation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  </head>

  <body>
    <div class="container">
      <h1>Monthly Report Form</h1>
      <p class="subtitle">ICAR Institute Research Information System</p>

      <div id="alertBox" class="alert"></div>

      <form id="scientistForm">
        <!-- BASIC INFO -->
        <div class="section">
          <h2 class="section-title">Basic Information</h2>

          <div class="form-group">
            <label for="smd_name">SMD Name</label>
            <input
              type="text"
              id="smd_name"
              value="Crop Science"
              placeholder="e.g., Crop Science"
            />
            <small class="small"
              >If you wish to change SMD name, edit this field.</small
            >
          </div>

          <div class="form-group">
            <label for="institute_name">Institute Name Short*</label>
            <div style="display: flex; align-items: center">
              <span
                style="
                  padding: 10px 12px;
                  background: #e9ecef;
                  border: 2px solid #ddd;
                  border-right: none;
                  border-radius: 8px 0 0 8px;
                "
                >ICAR-</span
              >
              <input
                type="text"
                id="institute_name"
                value="IIAB"
                required
                style="border-radius: 0 8px 8px 0; flex: 1"
              />
            </div>
            <small class="small"
              >Default: <strong>IIAB</strong> — you may change it.</small
            >
          </div>

          <div class="form-group">
            <label for="scientist_name">Scientist Name*</label>
            <input
              type="text"
              id="scientist_name"
              required
              placeholder="Enter scientist name (no titles: e.g., Dr., Mr. etc.)"
            />
          </div>

          <div class="two-column">
            <div class="form-group">
              <label for="month">Month*</label>
              <select id="month" required>
                <option>January</option>
                <option>February</option>
                <option>March</option>
                <option>April</option>
                <option>May</option>
                <option>June</option>
                <option>July</option>
                <option>August</option>
                <option>September</option>
                <option>October</option>
                <option>November</option>
                <option>December</option>
              </select>
              <small class="small">
                <strong id="dynamicCaution" class="blink-caution"></strong>
              </small>
            </div>
            <div class="form-group">
              <label for="year">Year*</label>
              <select id="year" required></select>
            </div>
          </div>
        </div>

        <!-- H-Index & Citations -->
        <div class="section">
          <h2 class="section-title">H-Index & Citations</h2>
          <div class="two-column">
            <div class="form-group">
              <label for="h_ind_google">H-Index (Google Scholar)</label>
              <input
                type="number"
                id="h_ind_google"
                min="0"
                placeholder="Enter H-Index"
              />
            </div>
            <div class="form-group">
              <label for="h_ind_res_gate">H-Index (Research Gate)</label>
              <input
                type="number"
                id="h_ind_res_gate"
                min="0"
                placeholder="Enter H-Index"
              />
            </div>
          </div>

          <div class="two-column">
            <div class="form-group">
              <label for="num_cit_google">Citations (Google Scholar)</label>
              <input
                type="number"
                id="num_cit_google"
                min="0"
                placeholder="Enter citations"
              />
            </div>
            <div class="form-group">
              <label for="num_cit_res_gate">Citations (Research Gate)</label>
              <input
                type="number"
                id="num_cit_res_gate"
                min="0"
                placeholder="Enter citations"
              />
            </div>
          </div>
        </div>

        <!-- COLLAPSIBLE: PROJECTS -->
        <div class="collapsible-section" id="projectsSection">
          <div class="collapsible-header" onclick="toggleSection('projects')">
            <h2 class="section-title">
              Externally Funded Projects (&gt;50 Lakhs)
            </h2>
            <span class="toggle-icon" id="projectsToggle">+</span>
          </div>
          <div class="collapsible-content" id="projectsContent">
            <div class="table-container">
              <table id="projectsTable" class="data-table">
                <thead>
                  <tr>
                    <th>S.No.</th>
                    <th>Project Title</th>
                    <th>Funding Agency</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Duration</th>
                    <th>Budget</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="projectsBody"></tbody>
              </table>
            </div>
            <button
              type="button"
              class="btn btn-secondary"
              onclick="addProjectRow()"
            >
              + Add Project
            </button>
          </div>
        </div>

        <!-- COLLAPSIBLE: PROGRAMS -->
        <div class="collapsible-section" id="programsSection">
          <div class="collapsible-header" onclick="toggleSection('programs')">
            <h2 class="section-title">Programs Organized</h2>
            <span class="toggle-icon" id="programsToggle">+</span>
          </div>
          <div class="collapsible-content" id="programsContent">
            <div class="table-container">
              <table id="programsTable" class="data-table">
                <thead>
                  <tr>
                    <th>S.No.</th>
                    <th>Title</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Duration</th>
                    <th>Venue</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="programsBody"></tbody>
              </table>
            </div>
            <button
              type="button"
              class="btn btn-secondary"
              onclick="addProgramRow()"
            >
              + Add Program
            </button>
          </div>
        </div>

        <!-- COLLAPSIBLE: IPR -->
        <div class="collapsible-section" id="iprSection">
          <div class="collapsible-header" onclick="toggleSection('ipr')">
            <h2 class="section-title">IPR Generated</h2>
            <span class="toggle-icon" id="iprToggle">+</span>
          </div>
          <div class="collapsible-content" id="iprContent">
            <div class="table-container">
              <table id="iprTable" class="data-table">
                <thead>
                  <tr>
                    <th>S.No.</th>
                    <th>IPR Name/Type</th>
                    <th>Date of Grant</th>
                    <th>Registration No.</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="iprBody"></tbody>
              </table>
            </div>
            <button
              type="button"
              class="btn btn-secondary"
              onclick="addIPRRow()"
            >
              + Add IPR
            </button>
          </div>
        </div>

        <!-- COLLAPSIBLE: TECH COMMERCIALIZATION -->
        <div class="collapsible-section" id="techComSection">
          <div class="collapsible-header" onclick="toggleSection('techCom')">
            <h2 class="section-title">Technology Commercialization</h2>
            <span class="toggle-icon" id="techComToggle">+</span>
          </div>
          <div class="collapsible-content" id="techComContent">
            <div class="table-container">
              <table id="techComTable" class="data-table">
                <thead>
                  <tr>
                    <th>S.No.</th>
                    <th>Head</th>
                    <th>Name</th>
                    <th>Licensee</th>
                    <th>Date</th>
                    <th>License Fee</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="techComBody"></tbody>
              </table>
            </div>
            <button
              type="button"
              class="btn btn-secondary"
              onclick="addTechComRow()"
            >
              + Add Entry
            </button>
          </div>
        </div>

        <!-- COLLAPSIBLE: PUBLICATIONS -->
        <div class="collapsible-section" id="pubSection">
          <div class="collapsible-header" onclick="toggleSection('pub')">
            <h2 class="section-title">Publications</h2>
            <span class="toggle-icon" id="pubToggle">+</span>
          </div>
          <div class="collapsible-content" id="pubContent">
            <div class="table-container">
              <table id="pubTable" class="data-table">
                <thead>
                  <tr>
                    <th>S.No.</th>
                    <th>Publication (APA Style)</th>
                    <th>Impact Factor</th>
                    <th>NAAS Rating</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="pubBody"></tbody>
              </table>
            </div>
            <button
              type="button"
              class="btn btn-secondary"
              onclick="addPubRow()"
            >
              + Add Publication
            </button>
          </div>
        </div>

        <!-- COLLAPSIBLE: TRAINING -->
        <div class="collapsible-section" id="trainSection">
          <div class="collapsible-header" onclick="toggleSection('train')">
            <h2 class="section-title">Training Conducted</h2>
            <span class="toggle-icon" id="trainToggle">+</span>
          </div>
          <div class="collapsible-content" id="trainContent">
            <div class="table-container">
              <table id="trainTable" class="data-table">
                <thead>
                  <tr>
                    <th>S.No.</th>
                    <th>Training Type</th>
                    <th>Training Name</th>
                    <th>Sponsor</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Duration</th>
                    <th>Participants</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="trainBody"></tbody>
              </table>
            </div>
            <button
              type="button"
              class="btn btn-secondary"
              onclick="addTrainRow()"
            >
              + Add Training
            </button>
          </div>
        </div>

        <!-- RESEARCH HIGHLIGHTS -->
        <div class="section">
          <h2 class="section-title">
            Significant Research Findings (Required)*
          </h2>

          <!-- ⭐ FINAL CORRECT FIGURE CONTROL PANEL -->
          <div id="figureControlPanel" style="margin-bottom: 12px">
            <button type="button" class="btn btn-secondary" id="addFigureBtn">
              + Add Figure
            </button>

            <!-- Dynamic figure cards -->
            <div id="figureCardList" style="margin-top: 10px"></div>
          </div>
          <!-- END FIGURE PANEL -->

          <div class="form-group">
            <label for="res_highlight"
              >Research Highlight (300-500 words)*</label
            >
            <textarea
              id="res_highlight"
              rows="6"
              required
              placeholder="Enter significant research findings (type NA if nothing) with potential impact..."
            ></textarea>

            <small class="small">
              Word count: <span id="wordCount">0</span><br />
              Placeholders like <code>[FIG-1]</code> will be inserted
              automatically. In the final Google Doc they become
              <code>Figure 1</code>, <code>Figure 2</code>, etc.
            </small>
          </div>
        </div>

        <!-- FOOTER BAR -->
        <div class="footer-bar">
          <div class="draft-note">
            Drafts auto-load on open; click Save Draft to keep current inputs
            locally.
          </div>
          <div class="footer-actions">
            <button type="button" class="btn btn-secondary" id="saveDraftBtn">
              Save Draft
            </button>
            <button type="button" class="btn btn-danger" id="clearDraftBtn">
              Clear Draft
            </button>
            <button type="submit" class="btn btn-primary" id="submitBtn">
              Submit
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- Figure Modal -->
    <div id="figureModal" class="modal hidden">
      <div class="modal-content">
        <h3 class="modal-title">Add Figure</h3>

        <div class="form-group">
          <label for="figFileInput">Select Image</label>
          <input
            type="file"
            id="figFileInput"
            accept=".jpg,.jpeg,.png,.tiff,.tif"
          />
        </div>

        <div class="form-group">
          <label>Preview</label>
          <img
            id="figPreview"
            class="hidden fig-preview"
            alt="Figure preview"
          />
        </div>

        <div class="form-group">
          <label for="figCaptionInput">Figure Caption</label>
          <textarea
            id="figCaptionInput"
            rows="3"
            placeholder="Enter concise caption for this figure"
          ></textarea>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" id="figInsertBtn">
            Insert Figure
          </button>
          <button type="button" class="btn btn-danger" id="figCancelBtn">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- JS -->
    <script src="script.js"></script>
  </body>
</html>
